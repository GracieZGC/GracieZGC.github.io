---
import WorkCarousel from "./WorkCarousel.astro";
import type { PortfolioItem } from "../data/portfolio";

type Props = {
	item: PortfolioItem;
};

const { item } = Astro.props;
const firstMedia = item.gallery?.[0];
const viewHref = firstMedia?.kind === "image" ? firstMedia.src : firstMedia?.kind === "video" ? firstMedia.src : undefined;
---

<article class="workItem" aria-label={item.title}>
	<WorkCarousel gallery={item.gallery} alt={item.title} maxWidth={960} showChrome={true} />

	<div class="content">
		<h2 class="title">{item.title}</h2>

		<div class="metaCol">
			{item.description ? <p class="desc">{item.description}</p> : null}

			{item.tags?.length ? (
				<div class="tags" aria-label="标签">
					{item.tags.map((t) => (
						<span class="tag" key={t}>
							{t}
						</span>
					))}
				</div>
			) : null}

			<div class="links" aria-label="链接">
				{item.focusPoints?.length ? (
					<details class="details">
						<summary class="link">Read case study →</summary>
						<div class="detailsBody">
							<ul>
								{item.focusPoints.map((p) => (
									<li>{p}</li>
								))}
							</ul>
						</div>
					</details>
				) : null}

				{viewHref ? (
					<a class="link" href={viewHref} target="_blank" rel="noreferrer">
						View project ↗
					</a>
				) : null}
			</div>
		</div>
	</div>
</article>

<style>
	.workItem {
		display: grid;
		gap: 22px;
		max-width: 960px;
		margin: 0 auto;
	}

	.content {
		display: grid;
		grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
		gap: 28px;
		padding: 0 2px 8px;
		align-items: start;
	}

	.title {
		margin: 0;
		font-size: 28px;
		font-weight: 800;
		letter-spacing: 0.01em;
		color: var(--text);
	}

	.desc {
		margin: 0;
		color: var(--muted);
		line-height: 1.8;
	}

	.tags {
		display: flex;
		flex-wrap: wrap;
		gap: 8px;
		margin-top: 10px;
	}
	.tag {
		display: inline-flex;
		align-items: center;
		padding: 4px 10px;
		border-radius: 999px;
		border: 1px solid rgba(37, 99, 235, 0.18);
		background: rgba(37, 99, 235, 0.08);
		font-size: 12px;
		color: var(--body);
	}

	.links {
		display: flex;
		gap: 24px;
		flex-wrap: wrap;
		margin-top: 18px;
		align-items: center;
	}
	.link {
		font-size: 14px;
		font-weight: 600;
		color: var(--accent);
		text-decoration: none;
	}
	.link:hover {
		text-decoration: underline;
	}

	.details {
		display: inline-flex;
		align-items: center;
	}
	.details summary {
		list-style: none;
		cursor: pointer;
	}
	.details summary::-webkit-details-marker {
		display: none;
	}
	.detailsBody {
		width: 100%;
		margin-top: 10px;
		color: var(--body);
	}
	.detailsBody ul {
		margin: 0;
		padding-left: 18px;
	}
	.detailsBody li {
		margin: 6px 0;
	}

	@media (max-width: 860px) {
		.content {
			grid-template-columns: 1fr;
			gap: 10px;
			padding: 0 2px 6px;
		}
		.title {
			font-size: 22px;
		}
	}
</style>
